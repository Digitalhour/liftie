mixin overlay(resort, text)
  .opening-date
    if resort.href
      a(href=resort.href,
        title='Go to official #{ resort.name } page',
        target='_blank'
      )!= text
    else
      a!= text

mixin header(resort, widget)
  if resort.href
    a.left.icon-alone.resort-link(
      href=resort.href,
      title='Go to official #{ resort.name } page',
      target='_blank'
    )
      span.ls-external
  a.left.resort-name(href='/resort/#{ resort.id }')= resort.name
  if !widget
    if resort.deals
      a.left.icon-alone(title=resort.deals.title, href=resort.deals.href, target="_blank")
        span.ls-deal
    if !single
      a.right.icon-alone.minimax(href='#')
        span.ls-minimax
    a.right.icon-alone.star(href='#')
      span.ls-star

mixin lifts(resort)
  .lifts-status
    if resort.opening
      +overlay(resort, 'Opens on <b>' + resort.opening + '</b>')
    else if !resort.lifts
      +overlay(resort, 'Lift status coming soon')
    ul.lifts.expandable
      if resort.lifts
        for status, name in resort.lifts.status
          li.lift
            span.name #{name}
            span.status(class='ls-#{status}')


mixin stats(resort)
  .summary-color-bar
    for key in ['open', 'hold', 'scheduled', 'closed']
      div(class='#{key}', style='width:#{ resort.lifts ? resort.lifts.stats.percentage[key] : 25 }%;')
  ul.summary
    for key in ['open', 'hold', 'scheduled', 'closed']
      li
        span(class='ls-#{key}')= resort.lifts ? resort.lifts.stats[key] : 0
        span #{key}
  .auto-refresh-reminder
    span Next update in&nbsp;
    span.time-to-refresh 60
    span &nbsp;seconds

mixin weather(resort)
  .weather(class= resort.weather ? 'visible' : 'hidden')
    img
    .temperature
    .conditions
    .text
    refkey = process.env.WUND_REF_KEY;
    if refkey
      weatherQuery = resort.ll ? '&query=' + resort.ll[1] + ',' + resort.ll[0] : ''
      .notice Forecast by&nbsp;
        a(href="http://www.wunderground.com/cgi-bin/findweather/getForecast?apiref=#{refkey}#{weatherQuery}", target="_blank")
          img(src="http://icons.wxug.com/logos/PNG/wundergroundLogo_black_horz.png")

mixin addToTrip(resort)
  if resort.ll
    a.add-to-trip
      span.ls-furkot
      span Plan trip to #{resort.name}

mixin resort(resort, widget)
  section.resort(
    data-resort=resort.id,
    data-timestamp=resort.timestamp,
    data-opening=resort.opening,
    data-name=resort.name,
    data-ll=resort.ll && resort.ll.join(),
    data-weather=single && resort.weather,
    class=resort.open ? 'open' : ''
  )
    header
      +header(resort, widget)
    .expandable
      .basics
        +lifts(resort)
        footer
          +stats(resort)
        if !widget && !single
          +addToTrip(resort)
  if !widget
    section.extras(class= single ? 'visible' : 'hidden' )
      +addToTrip(resort)
      +weather(resort)
