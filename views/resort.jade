mixin overlay(resort, text)
  .opening-date
    if resort.href
      a(href=resort.href,
        title='Go to official #{ resort.name } page',
        target='_blank'
      )!= text
    else
      a!= text

mixin resort(resort, widget)
  section.resort(
    data-resort=resort.id,
    data-timestamp=resort.timestamp,
    data-opening=resort.opening,
    data-name=resort.name,
    data-ll=resort.ll && resort.ll.join(),
    class=resort.open ? 'open' : ''
  )
    header
      if resort.href
        a.left.icon-alone.resort-link(
          href=resort.href,
          title='Go to official #{ resort.name } page',
          target='_blank'
        )
          span.ls-external
      a.left.resort-name(href='/resort/#{ resort.id }')= resort.name
      if !widget
        != decorateResort(resort)
        a.right.icon-alone.minimax(href='#')
          span.ls-minimax
        a.right.icon-alone.star(href='#')
          span.ls-star
    .expandable
      .lifts-status
        if resort.opening
          +overlay(resort, 'Opens on <b>' + resort.opening + '</b>')
        else if !resort.status
          +overlay(resort, 'Lift status coming soon')
        ul.lifts.expandable
          if resort.status
            for status, name in resort.status
              li.lift
                span.name #{name}
                span.status(class='ls-#{status}')
        footer
          .summary-color-bar
            for key in ['open', 'hold', 'scheduled', 'closed']
              div(class='#{key}', style='width:#{ resort.stats ? resort.stats.percentage[key] : 25 }%;')
          ul.summary
            for key in ['open', 'hold', 'scheduled', 'closed']
              li
                span(class='ls-#{key}')= resort.stats ? resort.stats[key] : 0
                span #{key}
          .auto-refresh-reminder
            span Next update in&nbsp;
            span.time-to-refresh 60
            span &nbsp;seconds
      if resort.ll && !widget
        a.add-to-trip
          span.ls-furkot
          span Plan trip to #{resort.name}
